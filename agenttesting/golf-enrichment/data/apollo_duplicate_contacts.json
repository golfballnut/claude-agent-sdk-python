{
  "test_name": "Apollo Duplicate Contact Bug - Production Data Integrity Issue",
  "description": "Apollo API returning same 4-5 contacts for every NC golf course, regardless of actual organization. Email domains don't match course domains, proving contacts are wrong.",
  "date_captured": "2025-10-30",
  "source": "Production logs from Render deployment - 98 NC courses affected",
  "severity": "P0 - Critical data integrity",
  "impact": {
    "affected_courses": 98,
    "bad_contacts": 382,
    "current_success_rate": "0%",
    "target_success_rate": "80%+"
  },
  "known_duplicate_person_ids": [
    "54a73cae7468696220badd21",
    "62c718261e2f1f0001c47cf8",
    "54a7002c7468696de70cf30b",
    "57db939ca6da986873a1fa42"
  ],
  "known_duplicate_contacts": [
    {
      "name": "Ed Kivett",
      "title": "General Manager - General Manager",
      "email": "ed@glenella.com",
      "actual_employer": "Glen Ella (different course)",
      "person_id": "54a73cae7468696220badd21"
    },
    {
      "name": "Brad Worthington",
      "title": "Director of Golf",
      "email": "brad@poundridgegolf.com",
      "actual_employer": "Pound Ridge Golf Club (different course)",
      "person_id": "62c718261e2f1f0001c47cf8"
    },
    {
      "name": "Greg Bryan",
      "title": "Head Golf Professional",
      "email": "greg@rfclub.com",
      "actual_employer": "RF Club (different course)",
      "person_id": "54a7002c7468696de70cf30b"
    },
    {
      "name": "Perry Langdon",
      "title": "Superintendent, Superintendent",
      "email": "plangdon@ellisdon.com",
      "actual_employer": "Ellis Don (construction company, NOT a golf course!)",
      "person_id": "57db939ca6da986873a1fa42"
    },
    {
      "name": "Nick Joy",
      "title": "Head Golf Professional",
      "email": "nick.joy@highpointegc.com",
      "actual_employer": "High Pointe GC (different course)"
    }
  ],
  "test_strategy": {
    "priority": "P0 - Must fix immediately",
    "validation_method": "Email domain must match course domain",
    "expected_fix_impact": "0% â†’ 80%+ correct contacts",
    "fallback_strategy": "Use Hunter.io when Apollo returns duplicates",
    "budget": "$0.20 per course"
  },
  "test_cases": [
    {
      "id": "test_1_deep_springs",
      "course_name": "Deep Springs Country Club",
      "domain": "deepspringscc.com",
      "website": "https://deepspringscc.com",
      "state": "NC",
      "course_id": 1100,
      "production_error": "Returned Ed Kivett (ed@glenella.com) - wrong domain",
      "expected_contacts_exclude": [
        "ed@glenella.com",
        "brad@poundridgegolf.com",
        "nick.joy@highpointegc.com",
        "plangdon@ellisdon.com"
      ],
      "validation_rules": {
        "email_domain_matches": "Email domain should contain 'deepspringscc.com'",
        "no_duplicate_person_ids": "Should not return person IDs: 54a73cae7468696220badd21, 62c718261e2f1f0001c47cf8, etc.",
        "min_contacts": 1,
        "max_cost": 0.20
      }
    },
    {
      "id": "test_2_deercroft",
      "course_name": "Deercroft Golf & Country Club",
      "domain": "deercroft.com",
      "website": "https://deercroft.com",
      "state": "NC",
      "course_id": 1194,
      "production_error": "Returned same 4 contacts as Deep Springs CC",
      "expected_contacts_exclude": [
        "ed@glenella.com",
        "brad@poundridgegolf.com",
        "nick.joy@highpointegc.com",
        "plangdon@ellisdon.com"
      ],
      "validation_rules": {
        "email_domain_matches": "Email domain should contain 'deercroft.com'",
        "no_duplicate_person_ids": true,
        "min_contacts": 1,
        "max_cost": 0.20
      }
    },
    {
      "id": "test_3_devils_ridge",
      "course_name": "Devils Ridge Golf Club",
      "domain": "invitedclubs.com",
      "website": "https://invitedclubs.com",
      "state": "NC",
      "course_id": 1224,
      "production_error": "Returned Greg Bryan instead of Nick Joy, but still duplicates",
      "expected_contacts_exclude": [
        "ed@glenella.com",
        "brad@poundridgegolf.com",
        "greg@rfclub.com",
        "plangdon@ellisdon.com"
      ],
      "validation_rules": {
        "email_domain_matches": "Email domain should contain 'invitedclubs.com'",
        "no_duplicate_person_ids": true,
        "min_contacts": 1,
        "max_cost": 0.20
      },
      "notes": "This is part of Invited Clubs chain - may have corporate emails"
    },
    {
      "id": "test_4_deer_brook",
      "course_name": "Deer Brook Golf Club",
      "domain": "clevecoymca.org",
      "website": "https://clevecoymca.org",
      "state": "NC",
      "course_id": 1103,
      "production_error": "Returned duplicate contacts despite YMCA domain",
      "expected_contacts_exclude": [
        "ed@glenella.com",
        "brad@poundridgegolf.com",
        "greg@rfclub.com",
        "plangdon@ellisdon.com"
      ],
      "validation_rules": {
        "email_domain_matches": "Email domain should contain 'clevecoymca.org' or 'ymca'",
        "no_duplicate_person_ids": true,
        "min_contacts": 1,
        "max_cost": 0.20
      },
      "notes": "YMCA-owned course - emails may be @clevecoymca.org"
    },
    {
      "id": "test_5_densons_creek",
      "course_name": "Densons Creek Golf Course",
      "domain": "densoncreekgolf.com",
      "website": "https://densoncreekgolf.com",
      "state": "NC",
      "course_id": 1163,
      "production_error": "Same duplicates as all other NC courses",
      "expected_contacts_exclude": [
        "ed@glenella.com",
        "brad@poundridgegolf.com",
        "nick.joy@highpointegc.com",
        "plangdon@ellisdon.com"
      ],
      "validation_rules": {
        "email_domain_matches": "Email domain should contain 'densoncreekgolf.com'",
        "no_duplicate_person_ids": true,
        "min_contacts": 1,
        "max_cost": 0.20
      }
    }
  ],
  "success_criteria": {
    "docker_tests": {
      "min_success_rate": 0.8,
      "description": "At least 80% of test cases (4/5) must pass",
      "pass_definition": "Course returns 1+ contacts with correct email domains, no duplicate person IDs"
    },
    "production_deployment": {
      "min_success_rate": 0.8,
      "monitoring_period": "First 10 enrichments",
      "rollback_trigger": "If success rate < 50% after 10 courses"
    },
    "data_quality": {
      "email_domain_validation": "Email domain must match or be subdomain of course domain",
      "no_duplicate_person_ids": "None of the known duplicate person IDs should appear",
      "min_contacts_per_course": 1,
      "max_cost_per_course": 0.20
    }
  },
  "expected_fixes": [
    "Add email domain validation before accepting contacts",
    "Detect and reject known duplicate person IDs",
    "Enhance Hunter.io fallback to trigger when Apollo returns suspicious data",
    "Add logging for rejected contacts (for debugging)"
  ],
  "root_cause_hypothesis": "Apollo API is ignoring organization_domain filter, returning same contacts from database regardless of domain parameter. Possible causes: sandbox API key, API bug, data quality issue, or account configuration problem."
}
